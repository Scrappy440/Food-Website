<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal Analysis - BiteThat!</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav class="nav-bar">
        <div class="nav-container">
            <div class="logo-text">
                <i class="fas fa-utensils"></i>
                <span>BiteThat!</span>
            </div>
            <div class="nav-buttons">
                <a href="#my-account" class="btn btn-sign">My Account</a>
                <a href="{{ url_for('home') }}" class="btn btn-home">Home</a>
                <a href="{{ url_for('logout') }}" class="btn btn-sec">Log out</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1><i class="fas fa-chart-line"></i> Meal Analysis</h1>
            <p>Discover which foods work best for you based on how you feel after eating them</p>
        </div>

        <div class="analysis-grid">
            <!-- Good Foods Card -->
            <div class="analysis-card good-foods-card">
                <div class="card-header">
                    <h2><i class="fas fa-thumbs-up"></i> Foods That Work Well For You</h2>
                    <p>Keep enjoying these!</p>
                </div>
                <div class="card-content">
                    {% if good_foods and good_foods|length > 0 %}
                        <ul class="food-list">
                            {% for row in good_foods %}
                                <li class="food-list-item">
                                    <div class="food-main-line">
                                        <span class="food-name">{{ row.name }}</span>
                                        <span class="food-score">
                                            {{ "%.1f"|format(row.personalized_score) }}
                                        </span>
                                    </div>
                                    <div class="food-sub-line">
                                        <span class="food-meals-count">
                                            Based on {{ row.n_meals }}
                                            meal{{ 's' if row.n_meals != 1 else '' }}
                                        </span>
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <div class="empty-state">
                            <i class="fas fa-info-circle"></i>
                            <p>No data yet! Log your meals and track how you feel to see personalized recommendations.</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Bad Foods Card -->
            <div class="analysis-card bad-foods-card">
                <div class="card-header">
                    <h2><i class="fas fa-exclamation-triangle"></i> Foods to Limit or Avoid</h2>
                    <p>These may not agree with you</p>
                </div>
                <div class="card-content">
                    {% if bad_foods and bad_foods|length > 0 %}
                        <ul class="food-list">
                            {% for row in bad_foods %}
                                <li class="food-list-item">
                                    <div class="food-main-line">
                                        <span class="food-name">{{ row.name }}</span>
                                        <span class="food-score bad">
                                            {{ "%.1f"|format(row.personalized_score) }}
                                        </span>
                                    </div>
                                    <div class="food-sub-line">
                                        <span class="food-meals-count">
                                            Based on {{ row.n_meals }}
                                            meal{{ 's' if row.n_meals != 1 else '' }}
                                        </span>
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <div class="empty-state">
                            <i class="fas fa-info-circle"></i>
                            <p>No data yet! Log your meals and track how you feel to see personalized recommendations.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Recommended Meals Section -->
        <div class="recommended-meals-section">
            <div class="section-header">
                <h2><i class="fas fa-lightbulb"></i> Recommended Meals For You</h2>
                <p>Meal ideas based on foods that work well for your body</p>
            </div>

           <div class="meals-grid">
    <!-- Breakfast card -->
    <div class="meal-card">
        <div class="meal-header">
            <h3><i class="fas fa-coffee"></i> Breakfast</h3>
        </div>
        <div class="meal-content">
            {% if recommended_meals.breakfast %}
                <ul>
                    {% for m in recommended_meals.breakfast %}
    <li>
       
        <strong>{{ m.eaten_at[:10] }}</strong><br>

       
        <strong>{{ m.title|capitalize }}</strong>
        — Score: {{ '%.1f'|format(m.meal_score) }}<br>

        
        {{ m.kcal|default(0)|round(0) }} kcal ·
        {{ m.protein_g|default(0)|round(1) }} g protein ·
        {{ m.carbs_g|default(0)|round(1) }} g carbs ·
        {{ m.sugar_g|default(0)|round(1) }} g sugar
    </li>
{% endfor %}

                </ul>
            {% else %}
                <p class="empty-meal-state">
                    Recommendations will appear here based on your data
                </p>
            {% endif %}
        </div>
    </div>

    <!-- Lunch card -->
    <div class="meal-card">
        <div class="meal-header">
            <h3><i class="fas fa-utensils"></i> Lunch</h3>
        </div>
        <div class="meal-content">
            {% if recommended_meals.lunch %}
                <ul>
                    {% for m in recommended_meals.lunch %}
    <li>
        <strong>{{ m.eaten_at[:10] }}</strong><br>
        <strong>{{ m.title|capitalize }}</strong>
        — Score: {{ '%.1f'|format(m.meal_score) }}<br>
        {{ m.kcal|default(0)|round(0) }} kcal ·
        {{ m.protein_g|default(0)|round(1) }} g protein ·
        {{ m.carbs_g|default(0)|round(1) }} g carbs ·
        {{ m.sugar_g|default(0)|round(1) }} g sugar
    </li>
{% endfor %}

                </ul>
            {% else %}
                <p class="empty-meal-state">
                    Recommendations will appear here based on your data
                </p>
            {% endif %}
        </div>
    </div>

        <!-- Dinner card -->
    <div class="meal-card">
        <div class="meal-header">
            <h3><i class="fas fa-drumstick-bite"></i> Dinner</h3>
        </div>
        <div class="meal-content">
            {% if recommended_meals.dinner %}
                <ul>
                    {% for m in recommended_meals.dinner %}
    <li>
        <strong>{{ m.eaten_at[:10] }}</strong><br>
        <strong>{{ m.title|capitalize }}</strong>
        — Score: {{ '%.1f'|format(m.meal_score) }}<br>
        {{ m.kcal|default(0)|round(0) }} kcal ·
        {{ m.protein_g|default(0)|round(1) }} g protein ·
        {{ m.carbs_g|default(0)|round(1) }} g carbs ·
        {{ m.sugar_g|default(0)|round(1) }} g sugar
    </li>
{% endfor %}
                </ul>
            {% else %}
                <p class="empty-meal-state">
                    Recommendations will appear here based on your data
                </p>
            {% endif %}
        </div>
    </div>

         </div>

        </div>
    </div>
</body>
</html>
